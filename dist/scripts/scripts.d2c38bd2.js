"use strict";angular.module("videoportalApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","restangular"]).run(["Restangular","session","$location",function(a,b,c){a.setBaseUrl("http://localhost:3000"),b.checkToken()?c.path("/"):c.path("/login")}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"login"}).when("/:id",{templateUrl:"views/video-detail.html",controller:"VideoDetailCtrl",controllerAs:"videoDetail"}).otherwise({redirectTo:"/"})}]),angular.module("videoportalApp").controller("MainCtrl",["session","$scope","Restangular",function(a,b,c){function d(a,c){i.customGET("",{sessionId:e,skip:a,limit:c}).then(function(a){"success"===a.status?(b.videos=b.videos.concat(a.data),$("#loading").hide()):console.log("Failed loading videos!")})}var e=a.getToken(),f=0,g=10;b.videos=[];var h=c.one("/user/logout"),i=c.all("/videos");$(window).scrollTop(),d(f,g),$(window).scroll(function(){$(window).scrollTop()===$(document).height()-$(window).height()&&($("#loading").show(),f+=10,d(f,g))}),b.logoutUser=function(){h.customGET("",{sessionId:e}).then(function(b){"success"===b.status?(a.setToken(null),localStorage.clear(),window.location.reload()):alert("Error logging out! Please try again.")})},b.getAverageRating=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return Math.round(b/a.length)}}]),document.addEventListener("play",function(a){for(var b=document.getElementsByTagName("video"),c=0,d=b.length;d>c;c++)b[c]!==a.target&&b[c].pause()},!0),angular.module("videoportalApp").controller("LoginCtrl",["$scope","Restangular","$location","session",function(a,b,c,d){a.save=function(){var e="",f=b.one("/user/auth");f.customPOST({username:a.user.username,password:a.user.password}).then(function(a){"success"===a.status?(e=a.sessionId,d.setToken(e),d.saveTokenToStorage(e),b.setDefaultHeaders({Authorization:"Bearer "+d.getToken()}),c.path("/")):(alert("User not found. Please sign up first!"),document.getElementById("username").value="",document.getElementById("password").value="")})}}]),angular.module("videoportalApp").service("session",function(){this.checkToken=function(){var a=!1;return a=null!==this.token&&""!==this.token&&"undefined"!==this.token&&void 0!==this.token?!0:null!==localStorage.getItem("token")&&""!==localStorage.getItem("token")&&"undefined"!==localStorage.getItem("token")&&void 0!==localStorage.getItem("token")?!0:!1},this.saveTokenToStorage=function(a){localStorage.setItem("token",a)},this.getToken=function(){return null!==this.token&&""!==this.token&&"undefined"!==this.token&&void 0!==this.token?this.token:localStorage.getItem("token")},this.setToken=function(a){this.token=a}}),angular.module("videoportalApp").controller("VideoDetailCtrl",["session","$location","Restangular","$scope",function(a,b,c,d){d.starRating=0,d.readOnly=!1;var e=a.getToken(),f=b.url(),g=f.substring(f.lastIndexOf("/")+1),h=c.one("/video"),i=c.one("/video/ratings");h.customGET("",{sessionId:e,videoId:g}).then(function(a){"success"===a.status?d.video=a.data:console.log("Failed loading video!")}),d.rateVideo=function(a){i.customPOST({videoId:g,rating:a},"",{sessionId:e}).then(function(b){"success"===b.status?(d.starRating=a,d.readOnly=!d.readOnly):alert("Error rating the video! Please try again.")})}}]),angular.module("videoportalApp").directive("starRating",function(){return{scope:{rating:"=",maxRating:"@",readOnly:"@",click:"&",mouseHover:"&",mouseLeave:"&"},restrict:"EA",template:"<div style='display: inline-block; margin: 0px; padding: 0px; cursor:pointer;' ng-repeat='idx in maxRatings track by $index'>                 <img ng-src='{{((hoverValue + _rating) <= $index) && \"http://www.codeproject.com/script/ratings/images/star-empty-lg.png\" || \"http://www.codeproject.com/script/ratings/images/star-fill-lg.png\"}}'                 ng-Click='isolatedClick($index + 1)'                 ng-mouseenter='isolatedMouseHover($index + 1)'                 ng-mouseleave='isolatedMouseLeave($index + 1)'></img>         </div>",compile:function(a,b){(!b.maxRating||Number(b.maxRating)<=0)&&(b.maxRating="5")},controller:["$scope","$element","$attrs",function(a,b,c){a.maxRatings=[];for(var d=1;d<=a.maxRating;d++)a.maxRatings.push({});a._rating=a.rating,a.isolatedClick=function(b){"true"!=a.readOnly&&(a.rating=a._rating=b,a.hoverValue=0,a.click({param:b}))},a.isolatedMouseHover=function(b){"true"!=a.readOnly&&(a._rating=0,a.hoverValue=b,a.mouseHover({param:b}))},a.isolatedMouseLeave=function(b){"true"!=a.readOnly&&(a._rating=a.rating,a.hoverValue=0,a.mouseLeave({param:b}))}}]}}),angular.module("videoportalApp").run(["$templateCache",function(a){a.put("views/login.html",'<div class="container"> <div class="row"> <h4 align="center">Login To The Crossover Video Portal</h4> <hr> </div> <div class="row"> <div class="col-md-4 col-sm-4"></div> <div class="col-md-4 col-sm-4"> <form> <div class="form-group"> <label for="username">Username:</label> <input required type="text" class="form-control" id="username" ng-model="user.username" placeholder="Enter username"> </div> <div class="form-group"> <label for="password">Password:</label> <input required type="password" class="form-control" id="password" ng-model="user.password" placeholder="Enter password"> </div> <button type="submit" class="btn btn-primary" ng-click="save()">Submit</button> </form> </div> <div class="col-md-4 col-sm-4"></div> </div> </div>'),a.put("views/main.html",'<div class="container" id="videos-page-container"> <div class="row" id="header-row"> <h5 class="pull-left">Welcome to the Video Portal</h5> <button class="btn btn-danger pull-right" ng-click="logoutUser()">Logout</button> </div> <hr> <div class="row" id="videos-row"> <div class="video" ng-repeat="video in videos"> <div id="video-content"> <div class="container" id="video-container"> <div class="row" id="video-text"> <a id="video-link" ng-href="#!/{{video._id}}">{{video.name}}</a> </div> <br> <div class="row" id="video-content-row"> <video id="video-element" width="100%" height="100%" controls ng-src="http://localhost:3000/{{video.url}}" type="video/mp4"> Your browser does not support HTML5 video. </video> </div> <br> <div class="row" id="rating-row"> <div align="center" star-rating rating="getAverageRating(video.ratings)" read-only="true"></div> </div> <br> <div class="row" id="video-description-row"> <p class="text-muted" id="video-description">{{video.description}}</p> </div> </div> </div> </div> </div> </div> <div align="center" id="loading"> <img src="images/loading.d694e953.gif" alt="Loadingâ€¦"> </div>'),a.put("views/video-detail.html",'<div class="container"> <div class="row"> <input class="pull-left" id="back-button" type="button" value="Back" onclick="history.back(-1)"> </div> <div class="row"> <div class="container" id="video-container"> <div class="row" id="video-text"> <a id="video-link-detail" ng-href="#!/{{video._id}}">{{video.name}}</a> </div> <br> <div class="row" id="video-content-row"> <video id="video-element" width="100%" height="100%" controls ng-src="http://localhost:3000/{{video.url}}" type="video/mp4"> Your browser does not support HTML5 video. </video> </div> <br> <div class="row" id="rating-row"> <div ng-if="!readOnly" id="rate-video"> <h3 id="rate-video-header">Rate Video:</h3> <div class="pull-left" id="stars-div" star-rating rating="starRating" click="rateVideo(param)"></div> </div> <div ng-if="readOnly" id="your-rating"> <h3 id="your-rating-header">Your Rating:</h3> <div class="pull-left" id="stars-div-read-only" read-only="true" star-rating rating="starRating"></div> </div> </div> <br> <div class="row" id="video-description-row"> <p id="description-paragraph">{{video.description}}</p> </div> </div> </div> </div>')}]);